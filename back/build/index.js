!function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=8)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ArgumentException=class extends Error{}},function(e,t){e.exports=require("sequelize")},function(e,t){e.exports=require("express")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(1),r=n(17);let s=new i.Sequelize(r.database,r.username,r.password,r);t.default=s},function(e,t){e.exports=require("jsonwebtoken")},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{u(i.next(e))}catch(e){s(e)}}function a(e){try{u(i.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}u((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(1),s=n(3),o=n(6),a=n(19);class u extends r.Model{checkPassword(e){return i(this,void 0,void 0,(function*(){return yield o.compare(e,this.password)}))}asViewModel(){return new a.UserViewModel(this.id,this.name,this.email,this.createdAt.toISOString(),this.updatedAt.toISOString())}}u.init({id:{type:r.DataTypes.INTEGER,autoIncrement:!0,primaryKey:!0},name:{type:new r.DataTypes.STRING(150),allowNull:!1},email:{type:new r.DataTypes.STRING(150),allowNull:!0},password:{type:new r.DataTypes.STRING(150),allowNull:!0}},{tableName:"user",sequelize:s.default}),t.default=u},function(e,t){e.exports=require("bcryptjs")},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{u(i.next(e))}catch(e){s(e)}}function a(e){try{u(i.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}u((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),s=n(27);t.LogUserBusiness=class{create(e){return i(this,void 0,void 0,(function*(){if(!e.userId||0==e.userId)throw new r.ArgumentException("Usuário não encontrado!");if(!e.operation||""==e.operation)throw new r.ArgumentException("Operação obrigatória!");if(!e.message||""==e.message)throw new r.ArgumentException("Mensagem obrigatória!");let t=yield s.default.create({user_id:e.userId,operation:e.operation,message:e.message});return yield t.asViewModel()}))}getAllByUerId(e){return i(this,void 0,void 0,(function*(){let t=yield s.default.findAll({where:{user_id:e}}),n=new Array;for(let e of t)n.push(yield e.asViewModel());return n}))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(9).default.listen(process.env.PORT||3333),console.log("Aplicação inicializada na porta: "+(process.env.PORT||3333))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(2),r=n(10);t.default=(new class{constructor(){this.express=i(),this.middlewares(),this.routes()}middlewares(){this.express.use(i.json())}routes(){this.express.use(r.default)}}).express},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(2),r=n(2),s=n(11),o=n(12),a=n(14),u=n(15),c=n(22),d=n(30),l=n(31),f=i.Router();f.use(s({origin:"*",methods:"GET,HEAD,PUT,PATCH,POST,DELETE",preflightContinue:!1,exposedHeaders:["token","id","image","Content-Type","Content-Lengths"],optionsSuccessStatus:204})),f.post("/auth",u.default.login),f.post("/createAndAuth",u.default.createAndAuth),f.get("/product/list",c.default.listAll),f.use("/files",r.static("tmp/uploads")),f.get("/logUser/byUser",a.default.validToken,d.default.getAllByUser),f.post("/saveImage",a.default.validToken,o.default.single("image"),l.default.saveFile),f.get("/product/:productId",a.default.validToken,c.default.findById),f.post("/product",a.default.validToken,c.default.create),f.put("/product/:productId",a.default.validToken,c.default.update),f.delete("/product/:productId",a.default.validToken,c.default.delete),t.default=f},function(e,t){e.exports=require("cors")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(13),r=i.diskStorage({destination:function(e,t,n){n(null,"tmp/uploads/")},filename:function(e,t,n){n(null,`${(new Date).toISOString()}-${t.originalname}`)}}),s=i({storage:r,fileFilter:function(e,t,n){["image/jpeg","image/jpg","image/png","image/gif"].includes(t.mimetype)?n(null,!0):n(null,!1)}});t.default=s},function(e,t){e.exports=require("multer")},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{u(i.next(e))}catch(e){s(e)}}function a(e){try{u(i.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}u((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(4);t.default=new class{validToken(e,t,n){return i(this,void 0,void 0,(function*(){let i=e.headers.authorization;if(!i)return t.status(401).json({message:"Token não existente!"});const[,s]=i.split(" ");try{let t=yield r.verify(s,process.env.APP_SECRET);return e.body.user_id=t.id,n()}catch(e){return t.status(401).json({message:"Token inválido!"})}}))}}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{u(i.next(e))}catch(e){s(e)}}function a(e){try{u(i.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}u((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(16),s=n(20),o=n(21);class a{constructor(e){null==a.userBusiness&&(a.userBusiness=e)}login(e,t){return i(this,void 0,void 0,(function*(){let n=e.body;try{let e=yield a.userBusiness.findByEmailAndPassword(o.AuthDTO.cast(n));return t.status(200).json({user:e,token:yield e.generateToken()})}catch(e){return t.status(401).json({message:e.message})}}))}createAndAuth(e,t){return i(this,void 0,void 0,(function*(){let n=e.body;try{let e=yield a.userBusiness.create(s.UserDTO.cast(n));return t.setHeader("token",yield e.generateToken()),t.status(201).json()}catch(e){return t.status(401).json({message:e.message})}}))}}t.default=new a(new r.UserBusiness)},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{u(i.next(e))}catch(e){s(e)}}function a(e){try{u(i.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}u((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(5),s=n(0);t.UserBusiness=class{create(e){return i(this,void 0,void 0,(function*(){if(null==e.name||!e.name)throw new s.ArgumentException("Nome obrigatório!");if(null==e.email||!e.email)throw new s.ArgumentException("E-mail obrigatório!");if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email))throw new s.ArgumentException("E-mail inválido!");if(null==e.password||!e.password)throw new s.ArgumentException("Senha obrigatória!");if(yield this.findByEmail(e.email))throw new Error("E-mail já cadastrado!");return(yield r.default.create({name:e.name,password:yield e.passwordEncrypted(),email:e.email})).asViewModel()}))}findByEmailAndPassword(e){return i(this,void 0,void 0,(function*(){let t=yield this.findByEmail(e.email);if(!t)throw new Error("Usuário não encontrado!");if(!(yield t.checkPassword(e.password)))throw new Error("Senha inválida!");return t.asViewModel()}))}findByEmail(e){return i(this,void 0,void 0,(function*(){return yield r.default.findOne({where:{email:e}})}))}}},function(e,t,n){n(18).config({path:".env"}),e.exports={host:process.env.DB_HOST,username:process.env.DB_USER,password:process.env.DB_PASSWORD,database:process.env.DB_NAME,dialect:process.env.DB_DIALECT||"mysql",storage:"./__tests__/database.sqlite",logging:!1,define:{timestamps:!0,underscored:!0,underscoredAll:!0}}},function(e,t){e.exports=require("dotenv")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(4);t.UserViewModel=class{constructor(e,t,n,i,r){this.id=e,this.name=t,this.email=n,this.createdAt=i,this.updatedAt=r}generateToken(){return i.sign({id:this.id},process.env.APP_SECRET)}}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{u(i.next(e))}catch(e){s(e)}}function a(e){try{u(i.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}u((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(6),s=n(0);class o{passwordEncrypted(){return i(this,void 0,void 0,(function*(){let e=yield r.genSalt(8);return yield r.hash(this.password,e)}))}static cast(e){if(!e.name)throw new s.ArgumentException("Atributo nome não encontrado!");if(!e.email)throw new s.ArgumentException("Atributo email não encontrado!");if(!e.password)throw new s.ArgumentException("Atributo senha não encontrado!");let t=new o;return t.name=e.name,t.email=e.email,t.password=e.password,t}}t.UserDTO=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0);class r{static cast(e){if(!e.email)throw new i.ArgumentException("Atributo email não encontrado!");if(!e.password)throw new i.ArgumentException("Atributo senha não encontrado!");let t=new r;return t.email=e.email,t.password=e.password,t}}t.AuthDTO=r},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{u(i.next(e))}catch(e){s(e)}}function a(e){try{u(i.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}u((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(23),s=n(26),o=n(7),a=n(29);class u{constructor(e,t){null==u.productBusiness&&(u.productBusiness=e),null==u.logUserBusiness&&(u.logUserBusiness=t)}listAll(e,t){return i(this,void 0,void 0,(function*(){try{let e=yield u.productBusiness.findAll();return t.status(200).json({products:e})}catch(e){return t.status(400).json({message:e.message})}}))}create(e,t){return i(this,void 0,void 0,(function*(){try{let n=yield u.productBusiness.create(s.ProductDTO.cast(e.body));return yield u.logUserBusiness.create(new a.LogUserDTO(parseInt(e.body.user_id),"Criar",`Usuário criou o produto ${n.name}.`)),t.setHeader("id",n.id),t.status(201).json()}catch(e){return t.status(400).json({message:e.message})}}))}update(e,t){return i(this,void 0,void 0,(function*(){try{let n=s.ProductDTO.cast(e.body);n.id=parseInt(e.params.productId);let i=yield u.productBusiness.update(n);return yield u.logUserBusiness.create(new a.LogUserDTO(parseInt(e.body.user_id),"Atualizar",`Usuário atualizou o produto ${i.name}.`)),t.status(200).json({product:i})}catch(e){return t.status(400).json({message:e.message})}}))}findById(e,t){return i(this,void 0,void 0,(function*(){try{let n=yield u.productBusiness.findById(parseInt(e.params.productId));return t.status(200).json({product:n})}catch(e){return t.status(404).json({message:e.message})}}))}delete(e,t){return i(this,void 0,void 0,(function*(){try{return yield u.productBusiness.deleteById(parseInt(e.params.productId)),yield u.logUserBusiness.create(new a.LogUserDTO(parseInt(e.body.user_id),"Deletar",`Usuário removeu o produto ${e.params.prodictId}.`)),t.status(204).json()}catch(e){return t.status(404).json({message:e.message})}}))}}t.ProductController=u,t.default=new u(new r.ProductBusiness,new o.LogUserBusiness)},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{u(i.next(e))}catch(e){s(e)}}function a(e){try{u(i.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}u((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(24),s=n(0);t.ProductBusiness=class{findAll(){return i(this,void 0,void 0,(function*(){let e=yield r.default.findAll({}),t=[];return yield e.forEach(e=>{t.push(e.asViewModel())}),t}))}create(e){return i(this,void 0,void 0,(function*(){return this.validations(e),(yield r.default.create({name:e.name,description:e.description,image:e.image,evaluation:e.evaluation})).asViewModel()}))}update(e){return i(this,void 0,void 0,(function*(){if(!e.id)throw new s.ArgumentException("Identificador obrigatório!");if(this.validations(e),yield r.default.update({name:e.name,description:e.description,image:e.image,evaluation:e.evaluation},{where:{id:e.id}}))return yield this.findById(e.id);throw new Error("Houve uma falha ao processar sua requisição!")}))}findById(e){return i(this,void 0,void 0,(function*(){let t=yield r.default.findOne({where:{id:e}});if(t)return t.asViewModel();throw new Error("Produto inexistente!")}))}deleteById(e){return i(this,void 0,void 0,(function*(){if(!(yield r.default.destroy({where:{id:e}})))throw new Error("Houve uma falha ao processar sua requisição!")}))}validations(e){if(""==e.name||!e.name)throw new s.ArgumentException("Nome obrigatório!");if(""==e.description||!e.description)throw new s.ArgumentException("Descrição obrigatória!");if(""==e.image||!e.image)throw new s.ArgumentException("Imagem obrigatória!");if(!e.evaluation&&0!=e.evaluation)throw new s.ArgumentException("Avaliação obrigatória!");if(e.evaluation<1||e.evaluation>5)throw new s.ArgumentException("Avaliação tem que ser entre 1 e 5!")}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(1),r=n(3),s=n(25);class o extends i.Model{asViewModel(){return new s.ProductViewModel(this.name,this.description,this.image,this.evaluation,this.createdAt.toISOString(),this.updatedAt.toISOString(),this.id)}}o.init({id:{type:i.DataTypes.INTEGER,autoIncrement:!0,primaryKey:!0},name:{type:new i.DataTypes.STRING(250),allowNull:!0},description:{type:new i.DataTypes.STRING(500),allowNull:!0},image:{type:new i.DataTypes.STRING(250),allowNull:!0},evaluation:{type:new i.DataTypes.NUMBER,allowNull:!0}},{tableName:"product",sequelize:r.default}),t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ProductViewModel=class{constructor(e,t,n,i,r,s,o){this.name=e,this.description=t,this.image=n,this.evaluation=i,this.createAt=r,this.updateAt=s,this.id=o}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0);class r{static cast(e){if(!e.name)throw new i.ArgumentException("Atributo nome não encontrado!");if(!e.description)throw new i.ArgumentException("Atributo descrição não encontrado!");if(!e.image)throw new i.ArgumentException("Atributo imagem não encontrado!");if(!e.evaluation)throw new i.ArgumentException("Atributo avaliação não encontrado!");let t=new r;return t.name=e.name,t.description=e.description,t.image=e.image,t.evaluation=e.evaluation,t}}t.ProductDTO=r},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{u(i.next(e))}catch(e){s(e)}}function a(e){try{u(i.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}u((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(1),s=n(3),o=n(5),a=n(28);class u extends r.Model{getUser(){return i(this,void 0,void 0,(function*(){return yield o.default.findOne({where:{id:this.user_id}})}))}asViewModel(){return i(this,void 0,void 0,(function*(){return new a.LogUserViewModel(this.id,this.operation,this.message,(yield this.getUser()).asViewModel(),this.createdAt.toISOString())}))}}t.LogUser=u,u.init({id:{type:r.DataTypes.INTEGER,autoIncrement:!0,primaryKey:!0},user_id:{type:r.DataTypes.INTEGER,allowNull:!1},operation:{type:new r.DataTypes.STRING(50),allowNull:!0},message:{type:new r.DataTypes.STRING(150),allowNull:!0}},{tableName:"log_user",sequelize:s.default}),t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.LogUserViewModel=class{constructor(e,t,n,i,r){this.id=e,this.operation=t,this.message=n,this.user=i}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.LogUserDTO=class{constructor(e,t,n){this.userId=e,this.operation=t,this.message=n}}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{u(i.next(e))}catch(e){s(e)}}function a(e){try{u(i.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}u((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(7);class s{constructor(e){null==s.logUserBusiness&&(s.logUserBusiness=e)}getAllByUser(e,t){return i(this,void 0,void 0,(function*(){try{let n=yield s.logUserBusiness.getAllByUerId(parseInt(e.body.user_id));return t.status(200).json({logsUser:n})}catch(e){return t.status(401).json({message:e.message})}}))}}t.default=new s(new r.LogUserBusiness)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{saveFile(e,t){let n=`${process.env.APP_ROUTE}${i.routeForAccess}${e.file.filename}`;try{return t.status(201).header({image:n}).json()}catch(e){return t.status(400).json({message:e.message})}}}i.routeForAccess="/files/",t.default=new i}]);